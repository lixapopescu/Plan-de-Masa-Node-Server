<div layout="column" layout-margin layout-fill layout-padding>
    <div flex>
        <h2>
            <div layout="row" layout-align="space-between center">
                <div>
                    <i class="fa fa-calendar"></i>
                    {{globalPlan.start.label}} 
                    <i class="fa fa-long-arrow-right"></i> 
                    {{globalPlan.last.label}}
                </div>
                <div>
                    <a href="#shoppingList" class="link-no-highlight">
                        <i class="fa fa-cart-arrow-down"></i>
                    </a>
                </div>
            </div>
        </h2>
    </div>
    <div layout="row" flex="50" id="recipeList" md-swipe-left="onSwipeLeft()">
        <div layout="row" layout-gt-sm="row" layout-md="row" layout-sm="column" layout-wrap>
            <div ng-repeat="day in dailyPlans | orderBy: '+date'" flex-gt-sm="25">
                <md-card ng-class="{todaybox: day.dayDistance == 0}" id="{{day.dayDistanceLabel}}">
                    <div layout="row" layout-align="space-between start">
                        <div>{{day.dayDistanceLabel}} </div>
                        <div>{{day.dayLabel}} {{day.date | date: 'dd/MM'}}</div>
                    </div>
                    <img ng-src="{{day.recipe.origin.image}}" alt="{{day.recipe._id}}" class="reteta-image reteta-titlu" ui-sref="retetaModal({recipe: day.recipe})">
                    <md-card-content>
                        <p ui-sref="retetaModal({recipe: day.recipe})" class="reteta-titlu">
                            {{day.recipe._id}}
                            <span class="fa-stack fa-lg reteta-abreviere-logo">
                                <i class="fa fa-circle-thin fa-stack-2x"></i>
                                <i class="fa fa-stack-1x">{{day.abbrev}}</i>
                            </span>
                        </p>
                        <p> <i class="fa fa-user"></i> {{day.recipe.persons}}
                            <i class="fa fa-shopping-cart"></i> {{countBoughtForRecipe(day.recipe,list)}} / {{day.recipe.ingredientNumber}}
                            <i class="fa fa-check" ng-if="countBoughtForRecipe(day.abbrev) == day.recipe.ingredientNumber"></i>
                        </p>
                    </md-card-content>
                    <md-card-footer>
                        <span class="fa fa-copyright"></span>
                        <a href="{{day.recipe.origin.url}}" target="_blank">
                            <span ng-if="!!day.recipe.origin.copyright">{{day.recipe.origin.copyright}}</span>
                        </a>
                    </md-card-footer>
                </md-card>
            </div>
        </div>
    </div>
    <div flex="50" id="shoppingList" layout="column" layout-wrap>
        <div ng-repeat="category in list | orderBy: '-ingredients.length'" class="item">
            <div class="box well">
                <div class="category-title" ng-click="toggleFolded(category)">
                    <i ng-if="category.folded" class="fa fa-plus"></i>
                    <i ng-if="!category.folded" class="fa fa-minus"></i> {{category._id}} ({{category.ingredients.length-countBought(category.ingredients)}})
                </div>
                <div>
                    <div ng-repeat="product in category.ingredients | orderBy: '+ name'" class="product">
                        <span ng-if="!product.bought" ng-click="toggleBought(product)">
                                        <i class="fa fa-square-o fa-fw"></i> {{product.name}}
                                        <span ng-if="product.total > 0">: {{product.total}} {{product.um}}</span>
                        </span>
                        <span ng-if="product.bought" ng-click="toggleBought(product)">
                                        <i class="fa fa-check-square-o fa-fw"></i>
                                        <span class="cumparat">{{product.name}}</span>
                        <span class="cumparat" ng-if="product.total > 0">: {{product.total}} {{product.um}}</span>
                        </span>
                        <span ng-if="category.folded || product.unfoldable" ng-repeat="det in product.details | orderBy: '+abbrev'">
                                        <span class="fa-stack fa-lg reteta-abreviere-logo">
                                            <i class="fa fa-circle-thin fa-stack-2x"></i>
                                            <i class="fa fa-stack-1x">{{det.abbrev}}</i>
                                        </span>
                        </span>
                        <div ng-if="!category.folded && !product.unfoldable" ng-repeat="det in product.details | orderBy: '+abbrev'">
                            <li>
                                <span class="fa-stack fa-lg reteta-abreviere-logo">
                                <i class="fa fa-circle-thin fa-stack-2x"></i>
                                <i class="fa fa-stack-1x">{{det.abbrev}}</i>
                            </span> {{det.quantity}} {{det.um}}
                                <span ng-if="det.comment" class="ingredient-comentariu">({{det.comment}})</span>
                            </li>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
